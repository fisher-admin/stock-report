<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aè‚¡é‡åŒ–é€‰è‚¡æŠ¥å‘Š</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .stock-card { transition: transform 0.2s, box-shadow 0.2s; cursor: pointer; }
        .stock-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .factor-bar { height: 8px; border-radius: 4px; background: #e5e7eb; overflow: hidden; }
        .factor-fill { height: 100%; border-radius: 4px; transition: width 0.6s ease; }
        .tag { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600; }
        .tag-up { background: #fee2e2; color: #dc2626; }
        .tag-down { background: #dcfce7; color: #16a34a; }
        .score-ring { width: 64px; height: 64px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.1rem; }
        .ai-score-ring { width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.9rem; }
        .detail-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .ai-section { background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border: 1px solid #bae6fd; border-radius: 12px; padding: 16px; margin-top: 12px; }
        .ai-badge { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; padding: 2px 10px; border-radius: 12px; font-size: 0.7rem; font-weight: 700; }
        .point-card { background: white; border-radius: 8px; padding: 8px 12px; text-align: center; }
        .risk-tag { background: #fef3c7; color: #92400e; padding: 2px 8px; border-radius: 8px; font-size: 0.7rem; }
        .catalyst-tag { background: #d1fae5; color: #065f46; padding: 2px 8px; border-radius: 8px; font-size: 0.7rem; }
        .advice-buy { background: #dcfce7; color: #166534; border: 1px solid #86efac; }
        .advice-hold { background: #fef9c3; color: #854d0e; border: 1px solid #fde047; }
        .advice-sell { background: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; }
        .advice-wait { background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; }
        .expand-icon { transition: transform 0.3s; }
        .expand-icon.open { transform: rotate(180deg); }
        @media (max-width: 640px) { .detail-grid { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body class="bg-gray-50">
<div id="app">
    <header class="text-white py-8 px-6" style="background: linear-gradient(135deg, #1e3a5f 0%, #2d6a9f 50%, #4a90d9 100%);">
        <div class="max-w-6xl mx-auto">
            <h1 class="text-3xl font-bold">ğŸ“Š Aè‚¡é‡åŒ–é€‰è‚¡æŠ¥å‘Š</h1>
            <p class="mt-1 opacity-90 text-sm">{{ strategy }}</p>
            <div class="mt-4 flex flex-wrap gap-2 text-xs">
                <span class="bg-white/20 px-3 py-1 rounded">ğŸ“… {{ updateTime }}</span>
                <span class="bg-white/20 px-3 py-1 rounded">ğŸ“ˆ æ‰«æ {{ totalStocks }} åª</span>
                <span class="bg-white/20 px-3 py-1 rounded">ğŸ† TOP {{ stocks.length }}</span>
                <span v-if="hasAI" class="bg-purple-500/40 px-3 py-1 rounded">ğŸ¤– AIåˆ†æ {{ aiCount }} åª</span>
            </div>
            <div v-if="backtest" class="mt-3 flex flex-wrap gap-2 text-xs">
                <span class="bg-green-500/30 px-3 py-1 rounded">å›æµ‹æ”¶ç›Š {{ backtest.total_return }}</span>
                <span class="bg-blue-500/30 px-3 py-1 rounded">å¤æ™® {{ backtest.sharpe }}</span>
                <span class="bg-yellow-500/30 px-3 py-1 rounded">èƒœç‡ {{ backtest.win_rate }}</span>
                <span class="bg-red-500/30 px-3 py-1 rounded">å›æ’¤ {{ backtest.max_drawdown }}</span>
            </div>
        </div>
    </header>
    <main class="max-w-6xl mx-auto px-4 py-6">
        <div v-if="factorWeights" class="bg-white rounded-xl p-4 shadow mb-6">
            <h3 class="text-sm font-bold text-gray-600 mb-2">ğŸ“ å› å­æƒé‡</h3>
            <div class="flex flex-wrap gap-2">
                <span v-for="(w, name) in factorWeights" class="text-xs bg-gray-100 px-2 py-1 rounded">
                    {{ name }} <b>{{ w }}</b>
                </span>
            </div>
        </div>

        <div v-if="loading" class="text-center py-16 text-gray-400">
            <p class="text-2xl mb-2">â³</p><p>åŠ è½½æ•°æ®ä¸­...</p>
        </div>
        <div v-for="s in stocks" :key="s.code" class="stock-card bg-white rounded-xl p-5 shadow mb-4 border-l-4"
            :class="s.change >= 0 ? 'border-red-500' : 'border-green-500'"
            @click="toggle(s.code)">
            <!-- å¤´éƒ¨: æ’å+åç§°+ä»·æ ¼+åŒè¯„åˆ† -->
            <div class="flex flex-wrap justify-between items-center gap-3">
                <div class="flex items-center gap-3">
                    <div class="text-2xl font-bold text-gray-300 w-8 text-center">{{ s.rank }}</div>
                    <div>
                        <div class="text-lg font-bold text-gray-800">{{ s.name }}</div>
                        <div class="text-gray-400 text-xs">{{ s.code }}</div>
                    </div>
                    <div class="ml-3 text-right">
                        <div class="text-xl font-bold" :class="s.change >= 0 ? 'text-red-600' : 'text-green-600'">Â¥{{ s.close }}</div>
                        <div class="text-sm font-medium" :class="s.change >= 0 ? 'text-red-500' : 'text-green-500'">
                            {{ s.change >= 0 ? 'ğŸ”´' : 'ğŸŸ¢' }}{{ s.change >= 0 ? '+' : '' }}{{ s.change.toFixed(2) }}%
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <div v-if="s.ai_score" class="text-center">
                        <div class="ai-score-ring" :style="aiScoreStyle(s.ai_score)">{{ s.ai_score }}</div>
                        <div class="text-xs text-gray-400 mt-1">AI</div>
                    </div>
                    <div class="text-center">
                        <div class="score-ring" :style="scoreStyle(s.score)">{{ s.score }}</div>
                        <div class="text-xs text-gray-400 mt-1">é‡åŒ–</div>
                    </div>
                    <span class="expand-icon text-gray-400" :class="{open: expanded[s.code]}">â–¼</span>
                </div>
            </div>

            <!-- AIæ“ä½œå»ºè®®æ ‡ç­¾ -->
            <div class="mt-3 flex flex-wrap gap-1.5 text-xs items-center">
                <span class="tag" :class="s.macd_dif > 0 ? 'tag-up' : 'tag-down'">MACD {{ s.macd_dif > 0 ? 'å¤šå¤´' : 'ç©ºå¤´' }}</span>
                <span class="tag" :class="s.rsi_6 < 30 ? 'tag-down' : s.rsi_6 > 70 ? 'tag-up' : 'bg-gray-100 text-gray-600'">RSI {{ s.rsi_6 }}</span>
                <span class="tag bg-purple-50 text-purple-700">ç­¹ç é›†ä¸­ {{ (s.chip_conc * 100).toFixed(1) }}%</span>
                <span class="tag bg-blue-50 text-blue-700">è·åˆ©ç‡ {{ s.winner_rate }}%</span>
                <span class="tag bg-yellow-50 text-yellow-700">é‡æ¯” {{ s.volume_ratio }}x</span>
                <span v-if="s.ai_advice" class="tag ml-2" :class="adviceClass(s.ai_advice)">ğŸ¤– {{ s.ai_advice }}</span>
            </div>

            <!-- AIä¸€å¥è¯ç»“è®º -->
            <div v-if="s.ai_conclusion" class="mt-2 text-sm text-indigo-700 bg-indigo-50 rounded-lg px-3 py-2">
                ğŸ’¡ {{ s.ai_conclusion }}
            </div>

            <!-- å±•å¼€åŒºåŸŸ -->
            <div v-if="expanded[s.code]" @click.stop>
                <!-- 9å› å­è¯„åˆ†æ¡ -->
                <div class="mt-4 detail-grid">
                    <div v-for="(score, name) in s.factor_scores" class="text-xs">
                        <div class="flex justify-between mb-1 text-gray-500">
                            <span>{{ name }}</span>
                            <span class="font-bold" :class="score >= 70 ? 'text-red-500' : score >= 50 ? 'text-yellow-600' : 'text-green-600'">{{ score }}</span>
                        </div>
                        <div class="factor-bar">
                            <div class="factor-fill" :style="{width: score+'%', background: barColor(score)}"></div>
                        </div>
                    </div>
                </div>

                <!-- AIæ·±åº¦åˆ†æåŒºåŸŸ -->
                <div v-if="s.ai_score" class="ai-section">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="ai-badge">ğŸ¤– AIæ·±åº¦åˆ†æ</span>
                        <span class="text-xs text-gray-500">Gemini 2.5 Flash</span>
                        <span v-if="s.ai_confidence" class="text-xs text-gray-400">ç½®ä¿¡åº¦: {{ s.ai_confidence }}</span>
                    </div>

                    <!-- ç²¾ç¡®ç‚¹ä½ -->
                    <div v-if="s.ai_points && Object.keys(s.ai_points).length" class="grid grid-cols-3 gap-2 mb-3">
                        <div class="point-card">
                            <div class="text-xs text-gray-400">ä¹°å…¥ç‚¹</div>
                            <div class="text-sm font-bold text-green-600">{{ s.ai_points.buy_point || s.ai_points.ideal_buy || '-' }}</div>
                        </div>
                        <div class="point-card">
                            <div class="text-xs text-gray-400">æ­¢æŸä½</div>
                            <div class="text-sm font-bold text-red-600">{{ s.ai_points.stop_loss || '-' }}</div>
                        </div>
                        <div class="point-card">
                            <div class="text-xs text-gray-400">ç›®æ ‡ä»·</div>
                            <div class="text-sm font-bold text-blue-600">{{ s.ai_points.take_profit || s.ai_points.target || '-' }}</div>
                        </div>
                    </div>

                    <!-- è¶‹åŠ¿åˆ†æ -->
                    <div v-if="s.ai_trend" class="mb-2">
                        <div class="text-xs font-bold text-gray-600 mb-1">ğŸ“ˆ è¶‹åŠ¿åˆ†æ</div>
                        <div class="text-xs text-gray-700 leading-relaxed">{{ s.ai_trend }}</div>
                    </div>

                    <!-- å‡çº¿åˆ†æ -->
                    <div v-if="s.ai_ma" class="mb-2">
                        <div class="text-xs font-bold text-gray-600 mb-1">ğŸ“Š å‡çº¿åˆ†æ</div>
                        <div class="text-xs text-gray-700 leading-relaxed">{{ s.ai_ma }}</div>
                    </div>

                    <!-- é‡èƒ½åˆ†æ -->
                    <div v-if="s.ai_volume" class="mb-2">
                        <div class="text-xs font-bold text-gray-600 mb-1">ğŸ“¦ é‡èƒ½åˆ†æ</div>
                        <div class="text-xs text-gray-700 leading-relaxed">{{ s.ai_volume }}</div>
                    </div>

                    <!-- åŸºæœ¬é¢ -->
                    <div v-if="s.ai_fundamental" class="mb-2">
                        <div class="text-xs font-bold text-gray-600 mb-1">ğŸ¢ åŸºæœ¬é¢</div>
                        <div class="text-xs text-gray-700 leading-relaxed">{{ s.ai_fundamental }}</div>
                    </div>

                    <!-- é£é™©ä¸å‚¬åŒ– -->
                    <div class="flex flex-wrap gap-1.5 mt-2">
                        <span v-for="r in (s.ai_risks || []).slice(0,3)" class="risk-tag">âš ï¸ {{ r }}</span>
                        <span v-for="c in (s.ai_catalysts || []).slice(0,3)" class="catalyst-tag">ğŸš€ {{ c }}</span>
                    </div>

                    <!-- é£é™©æç¤º -->
                    <div v-if="s.ai_risk_warning" class="mt-2 text-xs text-orange-700 bg-orange-50 rounded px-2 py-1">
                        âš ï¸ {{ s.ai_risk_warning }}
                    </div>

                    <!-- æ“ä½œæ¸…å• -->
                    <div v-if="s.ai_checklist && s.ai_checklist.length" class="mt-2">
                        <div class="text-xs font-bold text-gray-600 mb-1">âœ… æ“ä½œæ¸…å•</div>
                        <div v-for="item in s.ai_checklist" class="text-xs text-gray-600 ml-2">â€¢ {{ item }}</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-800 text-white py-6 text-center mt-8 text-sm">
        <p>ğŸ“Š Fisheré€‰è‚¡ v4.0 + ğŸ¤– AIæ·±åº¦åˆ†æ | æ•°æ®æ¥æº: Tushare Pro + Gemini</p>
        <p class="mt-1 text-gray-400">âš ï¸ ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®® | å†å²è¡¨ç°ä¸ä»£è¡¨æœªæ¥æ”¶ç›Š</p>
    </footer>
</div>

<script>
Vue.createApp({
    data() {
        return {
            stocks: [], updateTime: '', totalStocks: 0, strategy: '',
            factorWeights: null, backtest: null, loading: true,
            hasAI: false, aiCount: 0, expanded: {}
        }
    },
    methods: {
        toggle(code) {
            this.expanded[code] = !this.expanded[code];
        },
        scoreStyle(score) {
            let bg, color;
            if (score >= 80) { bg = '#fef2f2'; color = '#dc2626'; }
            else if (score >= 70) { bg = '#fff7ed'; color = '#ea580c'; }
            else if (score >= 60) { bg = '#fefce8'; color = '#ca8a04'; }
            else { bg = '#f0fdf4'; color = '#16a34a'; }
            return { background: bg, color: color, border: '3px solid ' + color };
        },
        aiScoreStyle(score) {
            let bg, color;
            if (score >= 70) { bg = '#eef2ff'; color = '#4f46e5'; }
            else if (score >= 55) { bg = '#fefce8'; color = '#ca8a04'; }
            else { bg = '#f3f4f6'; color = '#6b7280'; }
            return { background: bg, color: color, border: '2px solid ' + color };
        },
        barColor(score) {
            if (score >= 80) return '#ef4444';
            if (score >= 60) return '#f59e0b';
            if (score >= 40) return '#3b82f6';
            return '#6b7280';
        },
        adviceClass(advice) {
            if (!advice) return 'bg-gray-100 text-gray-600';
            if (advice.includes('ä¹°å…¥') || advice.includes('åŠ ä»“')) return 'advice-buy';
            if (advice.includes('å–å‡º') || advice.includes('å‡ä»“')) return 'advice-sell';
            if (advice.includes('è§‚æœ›')) return 'advice-wait';
            return 'advice-hold';
        }
    },
    async mounted() {
        try {
            const r = await fetch('data.json?' + Date.now());
            const d = await r.json();
            this.stocks = d.top20 || [];
            this.updateTime = d.update_time || '';
            this.totalStocks = d.total_stocks || 0;
            this.strategy = d.strategy || '';
            this.factorWeights = d.factor_weights || null;
            this.backtest = d.backtest || null;
            this.hasAI = d.has_ai_analysis || false;
            this.aiCount = d.ai_analyzed_count || 0;
            // åˆå§‹åŒ–å±•å¼€çŠ¶æ€
            this.stocks.forEach(s => { this.expanded[s.code] = false; });
        } catch(e) { console.error('åŠ è½½å¤±è´¥:', e); }
        this.loading = false;
    }
}).mount('#app');
</script>
</body>
</html>
